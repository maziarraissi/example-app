#!/bin/sh

SCRIPT_DIR="$(pwd)"
echo "Running script in directory: $SCRIPT_DIR"

# Get and display the current directory of this script
SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
echo "Running script in directory: $SCRIPT_DIR"

cd "$SCRIPT_DIR" || exit 1    # Ensure script runs from its own directory

# Source tutorial run functions
. "$WM_PROJECT_DIR/bin/tools/RunFunctions"

application=$(getApplication)

runApplication blockMesh
runApplication "$application" -functionObjects -writePhi -writep
runApplication foamPostProcess -func streamFunction

runApplication foamToVTK
#------------------------------------------------------------------------------

# Display first 50 lines of all log files
echo "===== Showing first 50 lines of all logs of OpenFOAM"
echo "===== Please check for any errors or warnings"
echo "===== If you need to see more lines, please open the log file directly"
find . -type f -name "log*" | while read -r log; do
    echo "---- $log ----"
    head -n 50 "$log"
    echo "--------------------------------------"
done
